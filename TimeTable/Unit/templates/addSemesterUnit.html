{% extends "base.html" %}

{% block title %}Add Semester Units{% endblock title %}

{% block body %}

    This is the add semester unit page
    ## Drag and Drop

    <style>
        #palette, #canvas {
            float: left;
            width: 45%;
            height: 300px;
            border: 1px solid #ddd;
            padding: 10px;
            margin: 10px;
            overflow: auto;
        }
        .draggable-unit {
            width: 200px;
            height: 35px;
            margin: 5px;
            padding: 5px;
            border: 1px solid black;
            cursor: move;
            position: relative;
            display: flex;
            justify-content: space-between;
        }
        .delete-button {
            cursor: pointer;
            color: red;
        }
        .popup-wrapper {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.5); /* Semi-transparent black background */
            width: 100%;
            height: 100%;
        }
        .popup {
            background: white;
            padding: 20px;
            max-width: 400px;
            margin: 100px auto;
            border-radius: 8px;
            position: relative;
        }
        .popup-close {
            position: absolute;
            top: 10px;
            right: 10px;
            cursor: pointer;
        }
    </style>
    <script>
        var addedToCanvas = new Set();
        
        function allowDrop(ev) {
            ev.preventDefault();
        }
        function drag(ev) {
            ev.dataTransfer.setData("text", ev.target.id);
        }
        function drop(ev) {
            ev.preventDefault();
            var data = ev.dataTransfer.getData("text");
            var draggedElement = document.getElementById(data);

            // Check if the drop target is the same as the drag source (palette)
            // If it is, do nothing to prevent appending to the same div
            if (ev.target.id !== draggedElement.parentNode.id && !addedToCanvas.has(data)) {
                var clonedElement = draggedElement.cloneNode(true);
                // Remove the draggable attribute from the cloned element
                clonedElement.removeAttribute("draggable");
                // Append the cloned element to the drop target
                ev.target.appendChild(clonedElement);
                // Add the element's ID to the set to prevent duplicates in the canvas
                addedToCanvas.add(data);
                // Add a delete button to the cloned element
                var deleteButton = document.createElement("span");
                deleteButton.className = "delete-button";
                deleteButton.innerHTML = "üóëÔ∏è";;
                deleteButton.onclick = function () {
                    // Remove the element from the canvas and update the set
                    ev.target.removeChild(clonedElement);
                    addedToCanvas.delete(data);
                };
                clonedElement.appendChild(deleteButton);
                var popup = document.querySelector('.popup-wrapper')
                var popupclose = document.querySelector('.popup-close').addEventListener('click', function(){
                    popup.style.display = 'none';
                })
                popup.style.display = 'block';
                console.log(popup);
            }
        }
    </script>
    <h2>Drag and Drop</h2>
    <p>Drag units from the palette to the canvas.</p>
    <!-- Palette -->
    <div id="palette" ondrop="drop(event)" ondragover="allowDrop(event)">
        {% for unit in units %}
            <div class="draggable-unit" draggable="true" ondragstart="drag(event)" id="unit_{{ unit.id }}">{{ unit.name }}</div>
        {% endfor %}
    </div>
    <!-- Canvas -->
    <div id="canvas" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
    <div class="popup-wrapper">
        <div class="popup">
            <div class="popup-close">X</div>
            <div class="popup-content">
                <h1>This is the popup</h1>
                <p> We are going to add more info here soon</p>
                <a href="#"> View Website</a>
            </div>
        </div>
    </div>



Form
<!-- <div>
    <form method='POST'>
        {% csrf_token %}
        <h3>Unit: {{form.Unit}}</h3>
        <h3>Lecturer: {{form.Lecturer}} </h3>
        <button type='submit'>Register Semester Unit</button>
    </form>
</div> -->

{% endblock body %}